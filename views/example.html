<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Example</title>
  <script src="../voip/underscore-1.8.3.js"></script>
</head>
<body>
  
</body>
<script>
/*
reduce(obj, callback(memo, value, index), start) 遍历对象，
memo 起始位置或者如果 start 有值是 start
value 是 obj 的属性值
index 是 obj 的属性

*/
function rename(obj, newNames){
  return _.reduce(newNames, function(memo, val, index){
    memo[val] = obj[index];
    return memo;
  }, _.omit(obj, _.keys(newNames)));
}

console.log(rename({a:1,b:2}, {a:'AAA'}));

function as(table, newNames){
	return _.map(table, function(obj){
		return rename(obj, newNames);
	});
}
var library = [{a:1, b:2, c:3}, {a:10, b:20, c:30}];
console.log(as(library, {a: 'count'}));

function restrict(list, pred){
	return _.reduce(list, function(memo, val){
		if (pred(val)) {
			return memo;
		}
		return _.without(list, val);
	});
}

var pred = function(val){
	return val > 1;
};

var list = [1,2,1,3];
console.log(restrict(list, pred));

var timeout = (ms) => {
	return new Promise((resolve, reject) => {
		setTimeout(() => {
			resolve('done');
		}, ms);
	});
};

function reset(obj, newValues){
	var objs = [obj];
	var keys = function(o){
		var tmp = [];
		for(var key in o){
			tmp.push(key);
		};
		return tmp;
	};

	var func = function(memo, val, index){
		keys(newValues).forEach(function(key){
			var memoObj = memo[0];
			memoObj[key] = newValues[key];
		});
		return memo;
	};
	return objs.reduce(func, objs)[0];
}

function createScaleFunc(factor){
	return function(vals){
		return _.map(vals, function(n){
			return n * factor;
		});
	};
}

function captureShadow(shadowed){
	return function(shadowed){
		return shadowed + 1;
	};
}
var closureCapture = captureShadow(100);

function plucker(field){
	return function(obj){
		return (obj && obj[field]);
	};
}

var getTitle = plucker('title');
var books = [{title:'123', author:'yu'}, {title:'456'}, {stars: 5}];

_.filter(books, getTitle);

function finder(valueFun, bestFun, coll){
	return _.reduce(coll, function(best, current){
		var bestValue = valueFun(best);
		var currentValue = valueFun(current);
		return (bestValue === bestFun(bestValue, currentValue)) ? best : current;
	});
}
console.log(finder(_.identity, Math.max, [1,2,3,4,5]));

function best(fun, coll){
	return _.reduce(coll, function(x, y){
		return fun(x, y) ? x : y;
	});
}
function repeat(times, fun){
	return _.map(_.range(times), function(){
		return fun();
	});
}

function iterateUntil(fun, check, init){
	var ret = [];
	var result = fun(init);
	while(check(result)){
		ret.push(result);
		result = fun(result);
	}
	return ret;
}

// function finder(valueFun, bestFun, coll){
// 	return _.reduce(coll, function(best, current){
// 		var bestValue = valueFun(best);
// 		var currentValue = valueFun(current);
// 		return (bestValue == bestFun(bestValue, currentValue)) ? best : current;
// 	});
// }
function finder(best, coll){
	return _.reduce(coll, function(x, y){
		return best(x, y) ? x : y;
	});
}

function always(value){
	return function(){
		return value;
	}
}
function repeat(times, fun){
	return _.map(_.range(times), fun);
}
repeat(3, always('OK'))
// => ["OK", "OK", "OK"]

function iterateUtil(func, check, init){
	var ret = [];
	var result = func(init);
	while(check(result)){
		ret.push(result);
		result = func(result);
	}
	return ret;
}
var result = iterateUtil(function(n){
	return n + n;
}, function(n){
	return n < 2048;
}, 1);

function fnull(func){
	var defaults = _.rest(arguments);
	return function(){
		var args = _.map(arguments, function(e, i){
			return e ? e : defaults[i];
		});
		return func.apply(null, args);
	};
}
var safeMutl = fnull(function(total, n){return total * n }, 1, 1);
_.reduce([1, 2, 3, null], safeMutl);
</script>
</html>