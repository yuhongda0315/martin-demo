<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Sticker</title>
  <style>
    html,body{
      overflow: hidden;
      background-color:#F5F5DC;
    }
    ul,li{
      margin: 0;
      list-style: none;
    }
    li{
      display: inline-block;
    }
    .rong-container{
      margin: 10% auto;
      height: 480px;
      width: 1000px;
      background-color: rebeccapurple;
    }
    .rong-editor{
      height: 480px;
      width: 50%;
      background-color: #bc8f8f;
      float: left;
      position: relative;
    }
    .rong-show{
      height: 480px;
      width: 50%;
      background-color:#b0e0e6;
      float: right;
      position: relative;
    }
    .rong-buttons{
      position: absolute;
      bottom: 5px;
      right: 10px;
    }
    .rong-button{
      height: 30px;
      width: 60px;
      background: none;
      outline: none;
      border: none;
      border-radius: 5px;
    }
    .rong-button:hover{
      cursor: pointer;
      background-color: #F0F8FF;
    }
    .rong-stickers{
      padding: 20px;
    }
    .rong-sticker{
      margin: 3px 11px;
    }
    .rong-sticker:hover{
      background-color: #F5F5DC;
      cursor: pointer;
      border-radius: 10px;
    }
    .rong-packages{
      position: absolute;
      bottom: 0;
      padding: 0;
      width: 100%;
      box-sizing: border-box;
      border-top: 1px solid #F0FFFF;
    }
    .rong-package{
      height: 30px;
      width: 30px;
      height: 30px;
      width: 30px;
      margin: 12px 0 0 7px;
      padding-left: 6px;
    }
    .rong-package:hover{
      cursor: pointer;
      background-color: #F0FFFF;
      border-radius: 5px;
    }
    .rong-rongcloud{
      background-size: contain;
      background-image: url(http://sticker.ronghub.com/c60plBGwk2686yv4vmv4H9/icon_c60plBGwk2686yv4vmv4H9.png);
      background-repeat: no-repeat;
    }
  </style>
</head>
<body>
  <script src="./sticker.js?123"></script>

  <div class="rong-container">
    <div class="rong-editor">
      <ul class="rong-stickers rong-editor-stickers"></ul>
      <ul class="rong-packages"></ul>
    </div>
    <div class="rong-show">
      <ul class="rong-stickers rong-show-stickers"></ul>
      <div class="rong-buttons">
        <input class="rong-button rong-button-clear" type="button" value="清空">
      </div>
    </div>
  </div>

  <script>
      var config = {
        appkey: '2222'
      };
      var stickerPkg = RongStickerPackage.init(config);
      var Sticker = stickerPkg.Sticker;
      var Package = stickerPkg.Package;
      var utils = stickerPkg.utils;

      var getDom = function(name){
        return document.getElementsByClassName(name)[0];
      };

      var packagesNode = getDom('rong-packages');
      var tpl = '<li class="rong-package rong-{name}" packageid={packageId}></li>';
      Package.getList(function(result){
        var packages = result.packages;
        utils.forEach(packages, function(package){
          packagesNode.innerHTML += utils.tplEngine(tpl, {
            name: package.author,
            packageId: package.id
          });
        });
        
        packagesNode.onclick = function(event){
          var target = event.target;
          var pacakgeId = target.getAttribute('packageid');
          if(pacakgeId){
            getStickers(pacakgeId);
          }
        };
      });
      
      var Cache = {};
      var stickersNode = getDom('rong-editor-stickers');
      var showNode = getDom('rong-show-stickers');
      function getStickers(pacakgeId){  
        var isFetch = Cache[pacakgeId];
        if(isFetch){
          return;
        }
        Cache[pacakgeId] = true;

        var package = {
          id: pacakgeId
        };
   
        var tpl = [
          '<li class="rong-sticker" >',
            '<img src="{url}" alt="{desc}" packageid={packageId} stickerid={stickerId} width="90">',
          '</li>'
        ].join('');
        Sticker.getList(package, function(result, error){
          var stickers = result.stickers;
          utils.forEach(stickers, function(sticker){
            stickersNode.innerHTML += utils.tplEngine(tpl, sticker);
          });

        });

        stickersNode.onclick = function(event){
          var target = event.target;
          var packageId = target.getAttribute('packageid');
          var stickerId = target.getAttribute('stickerid');

          if(packageId){
            var params = {
              packageId: packageId,
              stickerId: stickerId
            };
            Sticker.get(params, function(sticker, error){
              showNode.innerHTML += utils.tplEngine(tpl, sticker);
            });
          }
        };
      }

      var clearNode = getDom('rong-button-clear');
      clearNode.onclick = function(){
        showNode.innerHTML = '';
      };
    </script>
</body>
</html>