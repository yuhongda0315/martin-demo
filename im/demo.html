<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title> IM - Demo </title>
    <script src = "../js/jquery-3.1.1.min.js"></script>
    <script src = "../js/vue-2.0.1.js"></script>
    <!-- <script src = "data.js"></script> -->
    <script src = "../js/RongIMLib.js"></script>
	<script src = "./service.js"></script>
	<style>
		.container{
			float: left;
		}
		#tips{
			float: right;
			width: 60vw;
			background-color: #E5E5E5;
			height: 95vh;
			font-size: 13px;
			overflow: scroll;
		}
		.btns{
			width: 500px;
			height: 100px;
			border:1px dashed #000;
			margin-top: 10px;
		}
	</style>
</head>
<body>

<div class="container">
	<div class="btns">
		<input type="button" value="All" id="star-all"/>
		<input type="button" value="Connect" id="connect">
	</div>

	<div class="btns">
		<span>Organ:</span><br>
		<input type="button" value="getCompany" id="getCompany">
		<input type="button" value="getDept" id="getDept">
		<input type="button" value="getDeptNames" id="getDeptNames">
	</div>

	<div class="btns">
		<span>Star:</span><br>
		<input type="button" value="getAll" id="star-getAll">
		<input type="button" value="star" id="star">
		<input type="button" value="unstar" id="unstar">
		<input type="button" value="setDisplayName" id="star-setDisplayName">
	</div>

	<div class="btns">
		<span>Group:</span><br>
		<input type="button" value="get" id="group-getAll">
	</div>
</div>

<div id="tips">
    	
</div>
</body>
<script>
	var tips = $('#tips');
	var showResult = function(content, showLine){
		var style = showLine ? '<br/><hr/>' : '<br/>';
		tips.html(tips.html() + '<span>'  + JSON.stringify(content) +  '</span>' + style);
	};

	var config =  { appkey: 'z3v5yqkbvwla0', 
					dm: {
						data: ['DeptTree', 'Star']
					}
				  };
	var service = RongDataModel.init(config);
	var loginInfo = {
		username: 13671101652,
		password: 123456
	};
	service.User.login(loginInfo, function(code, result){
		service.fetchData(function(){
			console.log('fetch done');
			completed(result);
		});
	});

	var completed = function(info){

		$('#star-all').click(function(){
			service.Star.getAll(function(code, result){
				console.log(result);
			});
		});

		service.Status.watch(function(status){
			console.log(status);
		});

		$('#connect').click(function(){
			service.Status.connect(info.token);
		});

		$('#getCompany').click(function(){
			service.Organization.getCompany(function(code, result){
				showResult(result, true);
			});
		});
		
		$('#getDept').click(function(){
			var id = 'p3w9nJenftYG';
			service.Organization.getDept(id, function(code, result){
				showResult(result, true);
			});
		});

		$('#getDeptNames').click(function(){
			var ids = ['p3w9nJenftYG'];
			service.Organization.getDeptNames(ids, function(code, result){
				showResult(result, true);
			});
		});
		
		$('#star-getAll').click(function(){
			service.Star.getAll(function(code, result){
				showResult(result, true);
			});
		});

		$('#star').click(function(){
			var id = '8FdWJGQJKwYh';
			service.Star.star(id, function(code, result){
				showResult(result, true);
			});
		});

		$('#unstar').click(function(){
			var id = '8FdWJGQJKwYh';
			service.Star.unstar(id, function(code, result){
				showResult(result, true);
			});
		});

		$('#star-setDisplayName').click(function(){
			var info = {
				targetId: '8FdWJGQJKwYh',
				alias: '我是于洪达'
			};
			service.Star.setDisplayName(info, function(code, result){
				showResult(result, true);
			});
		});

		$('#group-getAll').click(function(){
			var userIds = ['8FdWJGQJKwYh'];
			service.Group.getAll(userIds, function(code, result){
				showResult(result, true);
			});
		});
	};
	
</script>
</html>