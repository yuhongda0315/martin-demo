<!DOCTYPE html>

<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width">
	<title>RongDataModel Source: datamodel.js</title>

	<!--[if lt IE 9]>
	<script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->
	<link type="text/css" rel="stylesheet" href="styles/sunlight.default.css">

	<link type="text/css" rel="stylesheet" href="styles/site.simplex.css">

</head>

<body>

<div class="navbar navbar-default navbar-fixed-top navbar-inverse">
<div class="container">
	<div class="navbar-header">
		<a class="navbar-brand" href="index.html">RongDataModel</a>
		<button class="navbar-toggle" type="button" data-toggle="collapse" data-target="#topNavigation">
			<span class="icon-bar"></span>
			<span class="icon-bar"></span>
			<span class="icon-bar"></span>
        </button>
	</div>
	<div class="navbar-collapse collapse" id="topNavigation">
		<ul class="nav navbar-nav">
			
			<li class="dropdown">
				<a href="namespaces.list.html" class="dropdown-toggle" data-toggle="dropdown">Namespaces<b class="caret"></b></a>
				<ul class="dropdown-menu inline">
					<li><a href="Conversation.html">Conversation</a></li><li><a href="ConversationProvider.html">ConversationProvider</a></li><li><a href="Friend.html">Friend</a></li><li><a href="FriendProvider.html">FriendProvider</a></li><li><a href="Group.html">Group</a></li><li><a href="GroupProvider.html">GroupProvider</a></li><li><a href="Message.html">Message</a></li><li><a href="MessageProvider.html">MessageProvider</a></li><li><a href="RongDataModel.html">RongDataModel</a></li><li><a href="Status.html">Status</a></li><li><a href="User.html">User</a></li><li><a href="UserProvider.html">UserProvider</a></li>
				</ul>
			</li>
			
		</ul>
        
            <div class="col-sm-3 col-md-3">
                <form class="navbar-form" role="search">
                    <div class="input-group">
                        <input type="text" class="form-control" placeholder="Search" name="q" id="search-input">
                        <div class="input-group-btn">
                            <button class="btn btn-default" id="search-submit"><i class="glyphicon glyphicon-search"></i></button>
                        </div>
                    </div>
                </form>
            </div>
        
	</div>

</div>
</div>


<div class="container" id="toc-content">
<div class="row">

	
	<div class="col-md-12">
	
		<div id="main">
			

		<h1 class="page-title">Source: datamodel.js</h1>
    
<section>
    <article>
        <pre
            class="sunlight-highlight-javascript linenums">/**
 * 初始化数据模型可以得到如下模型：
 * @namespace RongDataModel
 * @property {object}  User         - {@link User} 
 * @property {object}  Group        - {@link Group} 
 * @property {object}  Friend       - {@link Friend} 
 * @property {object}  Conversation - {@link Conversation} 
 * @property {object}  Message      - {@link Message} 
 * @property {object}  Status       - {@link Status} 
 */

"use strict";
(function(win, RongIMLib, RongIMClient) {
    var currentUserId = "";
    var option = (function() {
        return {
            max_msg_count: 20,
            max_conversation_count: 50,
            get_historyMsg_count: 5,
            // 接口测试服务
            server_path: 'http://10.10.112.167:3587/',
            group_head_count: 9,
            data: [] //'User', 'Group', 'Friend', 'GroupHead'
        };
    })();

    /** 工具类 */
    var forEach = function(object, callback) {
        for (var key in object) {
            callback(key, object[key]);
        }
    };
    var loop = function(arrs, callback) {
        for (var i = 0, len = arrs.length; i &lt; len; i++) {
            callback(arrs[i], i);
        }
    };
    var getPrototype = Object.prototype.toString;
    var events = {}; // 事件存储格式:events.MessageWatcher : [fun1, fun2]
    var emit = function(name, data) {
        if (name in events) {
            for (var i = 0, len = events[name].length; i &lt; len; i++) {
                events[name][i](data);
            }
        }
    };

    var destroy = function(name) {
        delete events[name];
    };

    var watcher = function(name, func, override) {
        if (typeof func != 'function' || typeof name != 'string') return;
        override &amp;&amp; destroy(name);
        events[name] = events[name] || [];
        events[name].push(func);
    };

    /**
     * options.headers :{}
     * options.method :'POST'
     * options.data :{}  
     * options.success :{}
     * options.error :{}  
     */
    var request = function(url, options) {
        var method = options.method || 'GET';
        options.headers || (options.headers = {
            'Content-Type': 'application/json; charset=utf-8'
        });
        var done = function(status, responseText) {
            var isSuccess = status >= 200 &amp;&amp; status &lt; 300 || status === 304;
            if (isSuccess) {
                options.success &amp;&amp; options.success(JSON.parse(responseText));
            } else {
                options.error &amp;&amp; options.error(status, responseText);
            }
        };
        var xhr = new XMLHttpRequest();
        xhr.onreadystatechange = function() {
            if (xhr.readyState == 4) {
                done(xhr.status, xhr.responseText);
            }
        };
        xhr.open(method, url, true);
        xhr.withCredentials = true; //TODO
        forEach(options.headers, function(key, value) {
            xhr.setRequestHeader(key, value);
        });
        xhr.send(options.data);
    };

    var jsonStringify = function(obj) {
        return JSON.stringify(obj);
    };
    // 数据格式:var user = {zhangsan:{id:'zhangsan',name:'name'}};
    var userFormat = function(data, callback) {
        for (var i = 0, len = data.length; i &lt; len; i++) {
            var user = data[i].user || data[i],
                obj = {};
            obj[user.id] = user;
            callback(obj);
        }
    };

    /**
       @namespace User
    */

    /**
        用户模型数据接口
        @namespace UserProvider
    */

    /**
     * 请求数据 url, 如果你用到用户模块，可以以根据下面的 url 进行重写服务。
     * @memberof UserProvider
     * @enum {string}
     */
    var userPath = {
        /** 获取全部用户信息 */
        all: 'user/all',
        /** 获取用户信息 */
        get: 'user/info/{userId}',
        /** 修改用户信息 */
        upate: 'user/{userId}/update',
        /** 登录 */
        login: 'user/login',
        /** 退出 */
        logout: 'user/logout',
        /** 修改密码 */
        change_pwd: 'user/change_password',
        /** 批量获取用户信息 */
        batch: 'user/batch',
        /** 修改自己的昵称 */
        set_nickname: 'user/set_nickname',
        /** 重置密码 */
        reset_pwd: 'user/reset_password',
        /** 发送验证码 */
        send_code: 'user/send_code',
        /** 校验验证码 */
        verify_code: 'user/verify_code',
        /** 检查手机号是否可用 */
        check_phone_available: 'user/check_phone_available',
        /** 注册 */
        register: 'user/register'
    };

    var fetchModelData = function(kinds, callback) {
        var count = 0,
            len = kinds.length;
        watcher('FetchEnd', function() {
            count++;
            count == len &amp;&amp; callback &amp;&amp; callback();
        });
        for (var i = 0; i &lt; len; i++) {
            var key = 'Pull_' + kinds[i];
            emit(key);
        }
    };

    var genUrl = function(url) {
        return option.server_path + url;
    };
    var ingoreUser = {};
    /**
        @memberof User
     */
    var UserDataProvider = {
        /** 
         *   获取用户信息
         *   @memberof UserProvider 
         *   @param {string}     userId      - 用户 Id 
         *   @param {function}   callback    - 函数回调
         */
        get: function(userId, callback) {
            // TODO 需要调整 DemoServer 获取不存在用户信息返回的错误码 ，以下为临时代码
            if (userId == '__system__') {
                callback({
                    user: {}
                });
            } else {
                var url = genUrl(userPath.get.replace(/{userId}/, userId));
                request(url, {
                    success: function(data) {
                        callback(data.result);
                    }
                });

            }
            // 正式
            // if (userId in ingoreUser) {
            //     callback({});
            //     return;
            // }
            // request(userPath.get.replace(/{userId}/, userId), null, function(data){
            //     if (data.code == '用户不存在的 code') {
            //         ingoreUser[userId] = "";
            //     }else{
            //         callback(data.result);
            //     }
            // });
        },
        batch: function(userIds, callback) {
            // TODO 修改 Demo Server batch 接口
            var ids = userIds.join("&amp;id=");
            var url = genUrl(userPath.batch + '?id=' + ids);
            request(url, {
                success: callback
            });
        },
        /** 
         *   获取全部用户信息
         *   @memberof UserProvider 
         *   @param {function}   callback    - 函数回调
         */
        getAll: function(callback) {
            var url = genUrl(userPath.all);
            request(url, {
                success: function(data) {
                    callback(data.result);
                }
            });
        },
        /** 
         * 修改用户信息
         * @memberof UserProvider 
         * @param {array|string}     users       - 用户或者用户数组
         * @param {function}         callback    - 函数回调
         */
        update: function(users, callback) {
            callback(users);
        },
        login: function(info, callback) {
            var url = genUrl(userPath.login);
            request(url, {
                method: 'POST',
                data: jsonStringify(info),
                success: function(result) {
                    callback(result);
                }
            });
        },
        logout: function(callback) {
            var url = genUrl(userPath.logout);
            request(url, {
                method: 'POST',
                success: callback
            });
        },
        changePwd: function(pwd, callback) {
            var url = genUrl(userPath.change_pwd);
            request(url, {
                data: jsonStringify(pwd),
                method: 'POST',
                success: callback
            });
        },
        resetPwd: function(pwd, callback) {
            var url = genUrl(userPath.reset_pwd);
            request(url, {
                data: jsonStringify(pwd),
                method: 'POST',
                success: callback
            });
        },
        setNickname: function(name, callback) {
            var url = genUrl(userPath.set_nickname);
            var data = {
                nickname: name
            };
            request(url, {
                data: jsonStringify(data),
                method: 'POST',
                success: callback
            });
        },
        sendCode: function(phone, callback) {
            var url = genUrl(userPath.send_code);
            request(url, {
                data: jsonStringify(phone),
                method: 'POST',
                success: callback
            });
        },
        verifyCode: function(code, callback) {
            var url = genUrl(userPath.verify_code);
            request(url, {
                data: jsonStringify(code),
                method: 'POST',
                success: callback
            });
        },
        checkPhone: function(phone, callback) {
            var url = genUrl(userPath.check_phone_available);
            request(url, {
                data: jsonStringify(phone),
                method: 'POST',
                success: callback
            });
        },
        register: function(user, callback) {
            var url = genUrl(userPath.check_phone_available);
            request(url, {
                data: jsonStringify(user),
                method: 'POST',
                success: callback
            });
        }
    };

    var User = (function(userProvider) {
        var data = {};
        /** 
         *   登录
         *   @memberof User 
         *   @param {object}     info     - 登录所需对象
         *   @param {string}     info.password - 密码
         *   @param {string}     info.phone - 手机号
         *   @param {string}     info.region - 号码区域标识
         *   @param {function}   callback - 登录结果在 callback 中返回
         *   @see {@link UserProvider}
             @example
             var _instance = RongDataModel.init({appkey:'appkey'});
             var info = {
                password:"admin000", 
                phone:"13269772769", 
                region:"86"
             };
             _instance.User.login(info, function(result){
                // result => {code:200, resut:{id:'userId', token:'token'}}
             });
         */
        var login = function(info, callback) {
            userProvider.login(info, function(result) {
                fetchModelData(option.data, function() {
                    callback(result);
                });
            });
        };
        /** 
         * 登出
         * @memberof User 
         * @param {function}   callback - 登录结果在 callback 中返回
         * @see {@link UserProvider}
           @example
           var _instance = RongDataModel.init({appkey:'appkey'});
           _instance.User.logout(function(result){
              // result => {code:200}
           });
         */
        var logout = function(callback) {
            userProvider.logout(function(result) {
                var methods = ['Conversation', 'Message'];
                methods.concat(option.data);
                for (var i = 0, len = methods.length; i &lt; len; i++) {
                    var key = 'Clear_' + methods[i];
                    emit(key);
                }
                callback &amp;&amp; callback(result);
            });
        };
        /** 
         * 根据老密码修改密码
         * @memberof User 
         * @param {object}   pwd - 密码信息
         * @param {string}   pwd.newPassword - 新密码
         * @param {string}   pwd.oldPassword - 老密码
         * @param {function}   callback - 登录结果在 callback 中返回
         * @see {@link UserProvider}
           @example
           var _instance = RongDataModel.init({appkey:'appkey'});
           var pwd = {
                newPassword:'',
                oldPassword:''
            };
           _instance.User.changePwd(pwd, function(result){
              // result => {code:200}
           });
         */
        var changePwd = function(pwd, callback) {
            userProvider.changePwd(pwd, callback);
        };
        /** 
         * 手机号重置密码
         * @memberof User 
         * @param {object}   pwd - 密码信息
         * @param {string}   pwd.password - 密码
         * @param {string}   pwd.verification_token - 验证码的返回值
         * @param {function}   callback - 登录结果在 callback 中返回
         * @see {@link UserProvider}
           @example
           var _instance = RongDataModel.init({appkey:'appkey'});
           var pwd = {
                password:'',
                verification_token:''
            };
           _instance.User.resetPwd(pwd, function(result){
              // result => {code:200}
           });
         */
        var resetPwd = function(pwd, callback) {
            userProvider.resetPwd(pwd, callback);
        };
        /** 
         * 发送验证码
         * @memberof User 
         * @param {object}   phone - 手机号信息
         * @param {string}   phone.region - 区域标识
         * @param {string}   phone.phone - 手机号
         * @param {function}   callback - 登录结果在 callback 中返回
         * @see {@link UserProvider}
           @example
           var _instance = RongDataModel.init({appkey:'appkey'});
           var phone = {
                region: 86
                phone: 13269772769
            };
           _instance.User.sendCode(phone, function(result){
              // result => {code:200}
           });
         */
        var sendCode = function(phone, callback) {
            userProvider.sendCode(phone, callback);
        };
        /** 
         * 校验验证码
         * @memberof User 
         * @param {object}   code - 验证码信息
         * @param {string}   code.region - 区域标识
         * @param {string}   code.phone - 手机号
         * @param {string}   code.code - 验证码
         * @param {function}   callback - 登录结果在 callback 中返回
         * @see {@link UserProvider}
           @example
           var _instance = RongDataModel.init({appkey:'appkey'});
           var code = {
                code: 374871
                region: 86
                phone: 13269772769
            };
           _instance.User.verifyCode(code, function(result){
              // result => {code:200, result:{verification_token:"ae667280-df77-11e5-bf19-6a8969f914"}}
           });
         */
        var verifyCode = function(code, callback) {
            userProvider.verifyCode(code, callback);
        };
        /** 
         * 校验手机号
         * @memberof User 
         * @param {object}   phone - 手机号信息
         * @param {string}   phone.region - 区域标识
         * @param {string}   phone.phone - 手机号
         * @param {function}   callback - 登录结果在 callback 中返回
         * @see {@link UserProvider}
           @example
           var _instance = RongDataModel.init({appkey:'appkey'});
           var phone = {
                region: 86
                phone: 13269772769
            };
           _instance.User.checkPhone(phone, function(result){
              // 手机号不可用 => {code:200, result:false, message: 'Phone number has already existed.'}
              // 手机号可用 => {code:200, result:true}
           });
         */
        var checkPhone = function(phone, callback) {
            userProvider.checkPhone(phone, callback);
        };
        /** 
         * 注册
         * @memberof User 
         * @param {object}   user - 用户注册信息
         * @param {string}   user.nickname - 名称
         * @param {string}   user.password - 密码
         * @param {string}   user.verificationToken - 验证码 token [校验验证码] 方法响应中获取
         * @param {function}   callback - 登录结果在 callback 中返回
         * @see {@link UserProvider}
           @example
           var _instance = RongDataModel.init({appkey:'appkey'});
           var user = {
                nickname: 'Martin'
                password: '808fk&amp;893',
                verificationToken: 'ae667280-df77-11e5-bf19-6a8969f914'
            };
           _instance.User.checkPhone(user, function(result){
              // result => {code:200}
           });
         */
        var register = function(user, callback) {
            userProvider.register(user, callback);
        };
        /** 
         *   修改用户信息
         *   @memberof User 
         *   @param {array|string}     users   - 用户或者用户数组
         *   @see {@link UserProvider} 
         *   @example
             var _instance = RongDataModel.init({appkey:'appkey'});
             var user = {id:'userId', name:'username', portraitUri:'http://xxx.xxx.com/portait.png'};
             _instance.User.set(user);
         */
        var set = function(userIds) {
            userProvider.update(users, function(result) {
                forEach(result, function(userId, user) {
                    data[userId] = user;
                });
            });
        };
        /** 
         *   获取用户信息
         *   @memberof User 
         *   @param {string}     userId   - 用户 Id
         *   @param {function}   callback - 用户信息在 callback 中返回
         *   @see {@link UserProvider}
             @example
             var _instance = RongDataModel.init({appkey:'appkey'});
             var userId = 'xxx';
             _instance.User.get(userId, function(user){
                // user: 用户信息
             });
         */
        var get = function(userId, callback) {
            if (userId in data) {
                callback(data[userId]);
            } else {
                userProvider.get(userId, function(user) {
                    data[user.id] = user;
                    callback(user);
                });
            }
        };
        var batch = function(userIds, callback) {
            userProvider.batch(userIds, function(result) {
                var users = result.result;
                loop(users, function(user) {
                    data[user.id] = user;
                });
                callback(users);
            });
        };
        /** 
         *   获取全部用户, 此方不从服务器获取用户信息
         *   返回值数据格式 var users = {userId1:{id:'userId1',name:'name'}};
         *   @memberof User 
         *   @param {array}      userIds - 用户 Id 数组
         *   @param {function}   callback - 用户信息在 callback 中返回
         *   @see {@link UserProvider}
             @example
             var _instance = RongDataModel.init({appkey:'appkey'});
             var userIds = ['userId1', 'userId2'];
             _instance.User.getUsers(userIds, function(users){
                // users 用户信息
                // 数据接口 {userId1:{id:'userId1',name:'name'}, userId2:{id:'userId2',name:'name'}}
             });
         */
        var getUsers = function(userIds, callback) {
            var users = {};
            for (var i = 0, len = userIds.length; i &lt; len; i++) {
                var userId = userIds[i];
                if (userId in data) {
                    users[userId] = data[userId];
                }
            }
            callback(users);
        };
        /** 
         * 设置自己的昵称
         * @memberof User 
         * @param {name}       userIds - 昵称
         * @see {@link UserProvider}
           @example
           var _instance = RongDataModel.init({appkey:'appkey'});
           var nickname = "Martin"
           _instance.User.setNickname(nickname, function(result){
                // result => {code: 200}
           });
         */
        var setNickname = function(name, callback) {
            userProvider.setNickname(name, function(result) {
                if (data[currentUserId]) {
                    data[currentUserId].nickname = name;
                }
                callback(result);
            });
        };

        var _push = function(userId, user) {
            if (data[userId]) {
                forEach(user, function(key, value) {
                    data[userId][key] = value;
                });
            } else {
                data[userId] = user;
            }

        };
        watcher('User', function(data) {
            forEach(data, function(userId, user) {
                _push(userId, user);
            });
        });

        watcher('Pull_User', function() {
            UserDataProvider.getAll(function(data) {
                emit('User', data);
                emit('FetchEnd');
            });
        });

        watcher('Clear_User', function() {
            data = {};
        });

        return {
            login: login,
            logout: logout,
            changePwd: changePwd,
            set: set,
            get: get,
            getUsers: getUsers,
            batch: batch,
            setNickname: setNickname,
            resetPwd: resetPwd,
            sendCode: sendCode,
            verifyCode: verifyCode,
            checkPhone: checkPhone,
            register: register
        };
    })(UserDataProvider);
    /** User DataModel end region */

    /** Friend DataModel region */

    /**
     *  @namespace Friend
     */

    /**
     * 好友模型数据接口
     * @namespace FriendProvider
     */

    /**
     * 请求数据 url, 如果你用到好友模块，可以以根据下面的 url 进行重写服务。
     * @memberof FriendProvider
     * @enum {string}
     */
    var friendPath = {
        /** 获取好友列表 */
        all: 'friendship/all',
        /** 申请加好友 */
        invite: 'friendship/invite',
        /** 同意加好友 */
        agree: 'friendship/agree',
        /** 忽略加好友请求 */
        ignore: 'friendship/ignore',
        /** 删除好友 */
        remove: 'friendship/delete',
        /** 设置好友备注 */
        setDisplayName: 'friendship/set_display_name'
    };

    var FriendDataProvider = {
        /** 
         * 请求加要好友  
         * @memberof FriendProvider 
         * @param {string}     friendId - 好友 Id 
         * @param {function}   callback - 邀请结果在 callback 中返回
         */
        invite: function(friendId, callback) {
            var data = {
                friendId: friendId
            };
            var url = genUrl(friendPath.invite);
            request(url, {
                method: 'POST',
                data: jsonStringify(data),
                success: callback
            });
        },
        /** 
         * 获取全部好友列表  
         * @memberof FriendProvider 
         * @param {function}   callback - 好友列表在 callback 中返回
         */
        getAll: function(callback) {
            var url = genUrl(friendPath.all);
            request(url, {
                success: callback
            });
        },
        /** 
         * 同意加好友  
         * @memberof FriendProvider 
         * @param {string}     friendId - 好友 Id 
         * @param {function}   callback - 同意结果 callback 中返回
         */
        agree: function(friendId, callback) {
            var data = {
                friendId: friendId
            };
            var url = genUrl(friendPath.agree);
            request(url, {
                method: 'POST',
                data: jsonStringify(data),
                success: callback
            });
        },
        /** 
         * 忽略加好友请求  
         * @memberof FriendProvider 
         * @param {string}     friendId - 好友 Id 
         * @param {function}   callback - 忽略 callback 中返回
         */
        ignore: function(friendId, callback) {
            var data = {
                friendId: friendId
            };
            var url = genUrl(friendPath.ignore);
            request(url, {
                method: 'POST',
                data: jsonStringify(data),
                success: callback
            });
        },
        /** 
         * 设置好友备注名称  
         * @memberof FriendProvider 
         * @param {string}     friendId - 好友 Id 
         * @param {string}     displayName - 备注名称
         * @param {function}   callback -  返回结果
         */
        setDisplayName: function(friendId, displayName, callback) {
            var data = {
                friendId: friendId,
                displayName: displayName
            };
            var url = genUrl(friendPath.setDisplayName);
            request(url, {
                method: 'POST',
                data: jsonStringify(data),
                success: callback
            });
        },
        /** 
         * 删除好友 
         * @memberof FriendProvider 
         * @param {string}     friendId - 好友 Id 
         * @param {function}   callback - 同意结果 callback 中返回
         */
        remove: function(friendId, callback) {
            var data = {
                friendId: friendId
            };
            var url = genUrl(friendPath.remove);
            request(url, {
                method: 'POST',
                data: jsonStringify(data),
                success: callback
            });
        }
    };

    var Friend = (function(friendDataProvider) {
        var data = [];
        /** 
          * 好友数据变化监控方法
          * @memberof Friend 
          * @param {string}     friend - 好友 
            @example
            var _instance = RongDataModel.init({appkey:'appkey'});\
            _instance.Friend.watch = function(friend){
                 // 所有好友数据发生变化会触发 watch 
            };
          */
        var watch = function(friend) {};
        /** 
         * 申请加好友
         * @memberof Friend 
         * @param {string}     friendId - 好友 Id
         * @see {@link FriendProvider}
         * @example
            var _instance = RongDataModel.init({appkey:'appkey'});
            var friendId = 'xxx';
            _instance.Friend.invite(friendId, functon(result){
                // 申请加好友结果
            });
         */
        var invite = function(friendId, callback) {
            friendDataProvider.invite(friendId, callback);
        };
        /** 
         * 同意加好友
         * @memberof Friend 
         * @param {string}     friendId - 好友 Id
         * @see {@link FriendProvider}
         * @example
            var _instance = RongDataModel.init({appkey:'appkey'});
            var friendId = 'xxx';
            _instance.Friend.agree(friendId, function(result){
               // 同意加好友结果
            });
         */
        var agree = function(friendId, callback) {
            //TODO 加好友成功后修改本地数据
            friendDataProvider.agree(friendId, callback);
        };
        /** 
         * 忽略加好友请求
         * @memberof Friend 
         * @param {string}     friendId - 好友 Id
         * @see {@link FriendProvider}
         * @example
            var _instance = RongDataModel.init({appkey:'appkey'});
            var friendId = 'xxx';
            _instance.Friend.ignore(friendId, function(result){
                //忽略加好友请求结果
            });
         */
        var ignore = function(friendId, callback) {
            friendDataProvider.ignore(friendId, callback);
        };
        var _success = function(result, cb) {
            for (var i = 0, len = data.length; i &lt; len; i++) {
                if (data[i].user.id == result.user.id) {
                    cb(i);
                    Friend.watch(result);
                    break;
                }
            }
        };
        /** 
         * 删除好友
         * @memberof Friend 
         * @param {string}     friendId - 好友 Id
         * @see {@link FriendProvider}
         * @example
            var _instance = RongDataModel.init({appkey:'appkey'});
            var friendId = 'xxx';
            _instance.Friend.remove(friendId);
         */
        var remove = function(friendId) {
            friendDataProvider.remove(friendId, function(result) {
                _success(result, function(index) {
                    data.splice(i, 1);
                });
            });
        };
        /** 
         * 设置好友备注
         * @memberof Friend 
         * @param {string}     friendId - 好友 Id
         * @param {string}     displayName - 备注名称
         * @see {@link FriendProvider}
         * @example
            var _instance = RongDataModel.init({appkey:'appkey'});
            var friendId = 'xxx', displayName = 'name';
            _instance.Friend.setDisplayName(friendId, displayName);
         */
        var setDisplayName = function(friendId, displayName) {
            friendDataProvider.setDisplayName(friendId, displayName, function(result) {
                _success(result, function(index) {
                    data[i] = result;
                });
            });
        };
        /** 
         * 获取好友列表
         * @memberof Friend 
         * @see {@link FriendProvider}
         * @example
            var _instance = RongDataModel.init({appkey:'appkey'});
            var friends = _instance.Friend.get();
            @returns {array}
         */
        var get = function() {
            return data;
        };
        var _push = function(friends) {
            data = friends;
        };
        watcher('Pull_Friend', function() {
            FriendDataProvider.getAll(function(data) {
                _push(data.result);
                userFormat(data.result, function(user) {
                    emit('User', user);
                });
                Friend.watch(data);
                emit('FetchEnd');
            });
        });

        watcher('Clear_Friend', function() {
            data.length = 0;
        });

        return {
            invite: invite,
            remove: remove,
            ignore: ignore,
            agree: agree,
            setDisplayName: setDisplayName,
            get: get,
            watch: watch,
            FriendDataProvider: friendDataProvider
        };
    })(FriendDataProvider);
    /** Friend DataModel end region*/

    /** Group DataModel region*/

    /**
     *  @namespace Group
     */

    /**
     * 群组模型数据接口
     * @namespace GroupProvider
     */

    /**
     * 请求数据 url, 如果你用到群组模块，可以以根据下面的 url 进行重写服务。
     * @memberof GroupProvider
     * @enum {string}
     */
    var groupPath = {
        /** 获取全部群组 */
        all: 'user/groups',
        /** 获取群成员 */
        members: 'group/info/{groupId}/members',
        /** 创建群 */
        create: 'group/create',
        /** 加入群 */
        join: 'group/join',
        /** 退出群 */
        quit: 'group/quit',
        /** 解散群 */
        dismiss: 'group/dismiss',
        /** 转让群主角色 */
        transfer: 'group/transfer',
        /** 发布群公告 */
        notice: 'group/set_bulletin',
        /** 设置群头像 */
        set_portrait_uri: 'group/set_portrait_uri',
        /** 设置自己的群昵称 */
        set_display_name: 'group/set_display_name',
        /** 群组重命名 */
        rename: 'group/rename',
        /** 踢人 */
        kick: 'group/kick',
        /** 加人 */
        add: 'group/add',
        /** 获取群头像信息 */
        head_info: 'group/{count}/head_info',

        add_to_address: 'group/add_to_address'
    };

    var GroupDataProvider = {
        /** 
         * 获取群组列表  
         * @memberof GroupProvider 
         * @param {function}   callback - 返回群组列表
         */
        get: function(callback) {
            var url = genUrl(groupPath.all);
            request(url, {
                success: callback
            });
        },
        /** 
         * 创建群  
         * @memberof GroupProvider 
         * @param {string}   name - 群名称
         * @param {array}    memberIds - 群成员 Id 数组
         * @param {function} callback - 返回群组列表
         */
        create: function(group, memberIds, callback) {
            var data = {
                name: group.name,
                memberIds: memberIds
            };
            group.portraitUri &amp;&amp; (data.portraitUri = group.portraitUri);
            var url = genUrl(groupPath.create);
            request(url, {
                method: 'POST',
                data: jsonStringify(data),
                success: callback
            });
        },
        /** 
         * 创建群  
         * @memberof GroupProvider 
         * @param {string}   groupId - 群 Id 
         * @param {function} callback - 返回加群结果
         */
        join: function(groupId, callback) {
            var data = {
                groupId: groupId
            };
            var url = genUrl(groupPath.join);
            request(url, {
                method: 'POST',
                data: jsonStringify(data),
                success: callback
            });
        },
        /** 
         * 退出群  
         * @memberof GroupProvider 
         * @param {string}   groupId - 群 Id 
         * @param {function} callback - 返回退群结果
         */
        quit: function(groupId, callback) {
            var data = {
                groupId: groupId
            };
            var url = genUrl(groupPath.quit);
            request(url, {
                method: 'POST',
                data: jsonStringify(data),
                success: callback
            });
        },
        /** 
         * 解散群  
         * @memberof GroupProvider 
         * @param {string}   groupId - 群 Id 
         * @param {function} callback - 返回解散群结果
         */
        dismiss: function(groupId, callback) {
            var data = {
                groupId: groupId
            };
            var url = genUrl(groupPath.dismiss);
            request(url, {
                method: 'POST',
                data: jsonStringify(data),
                success: callback
            });
        },
        /** 
         * 转让群主角色  
         * @memberof GroupProvider 
         * @param {string}   groupId - 群 Id 
         * @param {string}   userId - 新群主的 userId
         * @param {function} callback - 返回转让群主结果
         */
        transferManager: function(groupId, userId, callback) {
            var data = {
                groupId: groupId,
                userId: userId
            };
            var url = genUrl(groupPath.transfer);
            request(url, {
                method: 'POST',
                data: jsonStringify(data),
                success: callback
            });
        },
        /** 
         * 发布群公告  
         * @memberof GroupProvider 
         * @param {string}   groupId - 群 Id 
         * @param {string}   notice - 公告内容
         * @param {function} callback - 返回发布公告结果
         */
        setNotice: function(groupId, notice, callback) {
            var data = {
                groupId: groupId,
                bulletin: notice
            };
            var url = genUrl(groupPath.notice);
            request(url, {
                method: 'POST',
                data: jsonStringify(data),
                success: callback
            });
        },
        /** 
         * 设置群头像  
         * @memberof GroupProvider 
         * @param {string}   groupId - 群 Id 
         * @param {string}   portraitUri - 头像地址
         * @param {function} callback - 返回设置头像结果
         */
        setPortaitUri: function(groupId, portraitUri, callback) {
            var data = {
                groupId: groupId,
                portraitUri: portraitUri
            };
            var url = genUrl(groupPath.set_portrait_uri);
            request(url, {
                method: 'POST',
                data: jsonStringify(data),
                success: callback
            });
        },
        /** 
         * 设置群自己的群备注
         * @memberof GroupProvider 
         * @param {string}   groupId - 群 Id 
         * @param {string}   portraitUri - 头像地址
         * @param {function} callback - 返回设置头像结果
         */
        setDisplayName: function(groupId, displayName, callback) {
            var data = {
                groupId: groupId,
                displayName: displayName
            };
            var url = genUrl(groupPath.set_display_name);
            request(url, {
                method: 'POST',
                data: jsonStringify(data),
                success: callback
            });
        },
        /** 
         * 群组重命名
         * @memberof GroupProvider 
         * @param {string}   groupId - 群 Id 
         * @param {string}   name - 昵称
         * @param {function} callback - 返回重命名结果
         */
        rename: function(groupId, name, callback) {
            var data = {
                groupId: groupId,
                name: name
            };
            var url = genUrl(groupPath.rename);
            request(url, {
                method: 'POST',
                data: jsonStringify(data),
                success: callback
            });
        },
        /** 
         * 获取群成员
         * @memberof GroupProvider 
         * @param {string}   groupId - 群 Id 
         * @param {function} callback - 返回成员列表
         */
        getMembers: function(groupId, callback) {
            var url = genUrl(groupPath.members.replace(/{groupId}/, groupId));
            request(url, {
                success: function(data) {
                    callback(data.result);
                }
            });
        },
        /** 
         * 添加新成员
         * @memberof GroupProvider 
         * @param {string}   groupId - 群 Id 
         * @param {array}   memberIds - 成员 id 数组 
         * @param {function} callback - 返回添加成员结果
         */
        addMember: function(groupId, memberIds, callback) {
            var data = {
                groupId: groupId,
                memberIds: memberIds
            };
            var url = genUrl(groupPath.add);
            request(url, {
                method: 'POST',
                data: jsonStringify(data),
                success: callback
            });
        },
        /** 
         * 添加新成员
         * @memberof GroupProvider 
         * @param {string}   groupId - 群 Id 
         * @param {array}   memberIds - 成员 id 数组 
         * @param {function} callback - 返回踢人结果
         */
        kickMember: function(groupId, memberIds, callback) {
            var data = {
                groupId: groupId,
                memberIds: memberIds
            };
            var url = genUrl(groupPath.kick);
            request(url, {
                method: 'POST',
                data: jsonStringify(data),
                success: callback
            });
        },
        getHeadInfo: function(count, callback) {
            var url = genUrl(groupPath.head_info.replace(/{count}/, count));
            request(url, {
                success: callback
            });
        },
        addToAddress: function(groupId, show, callback) {
            var data = {
                groupId: groupId,
                show: show
            };
            var url = genUrl(groupPath.add_to_address);
            request(url, {
                method: 'POST',
                data: jsonStringify(data),
                success: callback
            });
        }
    };

    var Group = (function(groupDatProvider) {
        var data = [],
            groupMembers = {},
            headInfo = {};
        var createMember = function(user) {
            return {
                displayName: '',
                role: 0,
                createdAt: +new Date,
                updatedAt: +new Date,
                user: user
            };
        };
        /**
         * 数据改变事件监听
         * @memberof Group
         * @example
            var _instance = RongDataModel.init({appkey:'appkey'});
            _instance.Group.watch = function(groups){
                
            };
         */
        var watch = function(groups) {

        };
        /** 
         * 创建群
         * @memberof Group 
         * @param {string}   name - 群名称
         * @param {string}   memberIds - 群成员 Id 数组
         * @see {@link GroupProvider}
         * @example
            var _instance = RongDataModel.init({appkey:'appkey'});
            var group = {name:'', portraitUri:''};
            var memberIds = ['userId1', 'userId2', 'userId3'];
            _instance.Group.create(name, memberIds, function(groupInfo){
                // 创建群成功 groupInfo 群组信息
            });
         */
        var create = function(group, memberIds, callback) {
            groupDatProvider.create(group, memberIds, function(res) {
                var groupId = res.result.id;
                var groupInfo = {
                    role: 0,
                    show: 1,
                    group: {
                        id: groupId,
                        name: group.name,
                        portraitUri: group.portraitUri,
                        creatorId: currentUserId,
                        memberCount: memberIds.length,
                        maxMemberCount: 500
                    }
                };
                memberIds.length > option.group_head_count &amp;&amp; (memberIds.length = option.group_head_count);
                User.getUsers(memberIds, function(users) {
                    headInfo[groupId] = {
                        title: [],
                        portait: []
                    };
                    forEach(users, function(userId, user) {
                        headInfo[groupId].title.push(user.displayName || user.nickname);
                        headInfo[groupId].portait.push(user.portraitUri);
                    });
                    groupInfo.info = headInfo[groupId];
                    data.push(groupInfo);
                    callback(groupInfo);
                });

            });
        };
        /** 
         * 获取群列表
         * @memberof Group 
         * @param {string} groupId - 群 Id, 可选参数, 不传返回群列表
         * @see {@link GroupProvider}
         * @example
            var _instance = RongDataModel.init({appkey:'appkey'});
            // 获取群列表
            var groups = _instance.Group.get();
            // 获取群信息
            var groupId = 'xxx';
            var group = _instance.Group.get(groupId);
           @returns {array}
         */
        var get = function(groupId, callback) {
            if (typeof groupId == 'string') {
                var group = {
                    role: 1,
                    type: 0,
                    show: 0,
                    group: {
                        id: groupId,
                        name: "",
                        portraitUri: "",
                        creatorId: "",
                        memberCount: 0,
                        maxMemberCount: 0
                    }
                };
                for (var i = 0, len = data.length; i &lt; len; i++) {
                    if (groupId == data[i].group.id) {
                        group = data[i];
                        break;
                    }
                }
                group.info = headInfo[groupId];
                return group;
            } else {
                headInfo.length > 0 &amp;&amp; loop(data, function(item, index) {
                    data[index].info = headInfo[item.group.id];
                });
                return data;
            }
        };
        /** 
         * 加入群
         * @memberof Group 
         * @param {string}   groupId - 群 Id
         * @param {function}   callback - 返回加入群结果
         * @see {@link GroupProvider}
         * @example
            var _instance = RongDataModel.init({appkey:'appkey'});
            var groupId = 'groupId';
            _instance.Group.join(groupId, function(){
                // join Successfully
            });
         */
        var join = function(groupId, callback) {
            groupDatProvider.join(groupId, function() {
                User.get(currentUserId, function(user) {
                    groupMembers[groupId].push(createMember(user));
                });
                callback();
            });
        };

        var memberHandle = function(groupId, userId, callback) {
            var members = groupMembers[groupId];
            for (var i = 0, len = members.length; i &lt; len; i++) {
                if (userId == members[i].id) {
                    callback(i);
                    break;
                }
            }
        };
        /** 
         * 退出群
         * @memberof Group 
         * @param {string}   groupId - 群 Id
         * @param {function}   callback - 返回退出群结果
         * @see {@link GroupProvider}
         * @example
            var _instance = RongDataModel.init({appkey:'appkey'});
            var groupId = 'groupId';
            _instance.Group.join(groupId, function(){
                // quit Successfully
            });
         */
        var quit = function(groupId, callback) {
            groupDatProvider.quit(groupId, function(result) {
                memberHandle(groupId, currentUserId, function(index) {
                    groupMembers[groupId].splice(index, 1);
                });
                callback(result);
            });
        };
        /** 
         * 添加成员
         * @memberof Group 
         * @param {string}   groupId - 群 Id
         * @param {string}   memberIds - 群成员 Id 数组
         * @param {function}   callback - 返回添加成员结果
         * @see {@link GroupProvider}
         * @example
            var _instance = RongDataModel.init({appkey:'appkey'});
            var groupId = 'groupId';
            var memberIds = ['userId5', 'userId6'];
            _instance.Group.addMember(groupId, memberIds, function(members){
                //addMember Successfully
                // members 是新增的群成员
            });
         */
        var addMember = function(groupId, memberIds, callback) {
            groupDatProvider.addMember(groupId, memberIds, function() {
                User.getUsers(memberIds, function(users) {
                    groupMembers[groupId] = groupMembers[groupId] || [];
                    var members = [];
                    for (var i = 0, len = memberIds.length; i &lt; len; i++) {
                        var memberId = memberIds[i];
                        if (memberId in users) {
                            var member = createMember(users[memberId]);
                            groupMembers[groupId].push(member);
                            members.push(member);
                        }
                    }
                    callback(members);
                });
            });
        };
        /** 
         * 踢人
         * @memberof Group 
         * @param {string}   groupId - 群 Id
         * @param {string}   memberIds - 群成员 Id 数组
         * @param {function}   callback - 返回踢人结果
         * @see {@link GroupProvider}
         * @example
            var _instance = RongDataModel.init({appkey:'appkey'});
            var groupId = 'groupId';
            var memberIds = ['userId5', 'userId6'];
            _instance.Group.addMember(groupId, memberIds, function(){
                //kickMember Successfully
            });
         */
        var kickMember = function(groupId, memberIds, callback) {
            groupDatProvider.kickMember(groupId, memberIds, function() {
                var members = [];
                for (var i = 0, len = memberIds.length; i &lt; len; i++) {
                    memberHandle(groupId, memberIds[i], function(index) {
                        // 删除本地群成员并添加到临时数组，返回给 IM
                        var member = groupMembers[groupId].splice(index, 1);
                        members.push(member[0]);
                    });
                }
                callback(members);
            });
        };
        /** 
         * 设置自己的群昵称
         * @memberof Group 
         * @param {string}   groupId - 群 Id
         * @param {string}   displayName - 自己的群昵称
         * @param {function}   callback - 返回设置昵称结果
         * @see {@link GroupProvider}
         * @example
            var _instance = RongDataModel.init({appkey:'appkey'});
            var groupId = 'groupId';
            var displayName = 'name';
            _instance.Group.setDisplayName(groupId, displayName, function(){
                //setDisplayName Successfully
            });
         */
        var setDisplayName = function(groupId, displayName, callback) {
            groupDatProvider.setDisplayName(groupId, displayName, function() {
                memberHandle(groupId, currentUserId, function(index) {
                    groupMembers[groupId][index].displayName = displayName;
                });
                callback();
            });
        };
        /** 
         * 转让群主角色
         * @memberof Group 
         * @param {string}   groupId - 群 Id
         * @param {string}   userId - 新群主的 Id 
         * @param {function}   callback - 返回转让群主结果
         * @see {@link GroupProvider}
         * @example
            var _instance = RongDataModel.init({appkey:'appkey'});
            var groupId = 'groupId';
            var userId = 'userId';
            _instance.Group.setDisplayName(groupId, userId, function(){
                //transfer Successfully
            });
         */
        var transferManager = function(groupId, userId, callback) {
            groupDatProvider.transferManager(groupId, userId, function() {
                // 取消自己是管理员身份
                memberHandle(groupId, currentUserId, function(index) {
                    groupMembers[groupId][index].role = 1;
                });
                // 绑定指定用户为管理员
                memberHandle(groupId, userId, function(index) {
                    groupMembers[groupId][index].role = 0;
                });
                callback();
            });
        };
        /** 
         * 获取成员
         * @memberof Group 
         * @param {string}   groupId - 群 Id
         * @param {function}   callback - 返回群成员列表
         * @see {@link GroupProvider}
         * @example
            var _instance = RongDataModel.init({appkey:'appkey'});
            var groupId = 'groupId';
            _instance.Group.getMembers(groupId, function(members){
                //members:群成员列表
            });
         */
        var getMembers = function(groupId, callback) {
            if (groupId in groupMembers) {
                callback(groupMembers[groupId]);
            } else {
                var cacheMembers = function(members) {
                    // userFormat(members, function(user) {
                    //     emit('User', user); // fire User, cache userInfo.
                    // });
                    groupMembers[groupId] = members;
                    callback(members);
                };
                groupDatProvider.getMembers(groupId, cacheMembers);
            }
        };

        var groupHandle = function(groupId, callback) {
            for (var i = 0, len = data.length; i &lt; len; i++) {
                if (groupId == data[i].group.id) {
                    callback(i);
                    break;
                }
            }
        };
        /** 
         * 解散群组
         * @memberof Group 
         * @param {string}   groupId - 群 Id
         * @param {function} callback - 返回解散群结果
         * @see {@link GroupProvider}
         * @example
            var _instance = RongDataModel.init({appkey:'appkey'});
            var groupId = 'groupId';
            _instance.Group.dismiss(groupId, function(){
                //dismiss Group Successfully
            });
         */
        var dismiss = function(groupId, callback) {
            groupDatProvider.dismiss(groupId, function(result) {
                groupHandle(groupId, function(index) {
                    data.splice(index, 1);
                    delete groupMembers[groupId];
                });
                callback(result);
            });
        };
        /** 
         * 设置群头像
         * @memberof Group 
         * @param {string}   groupId - 群 Id
         * @param {string}   portraitUri - 头像地址
         * @param {function}   callback - 返回设置头像结果
         * @see {@link GroupProvider}
         * @example
            var _instance = RongDataModel.init({appkey:'appkey'});
            var groupId = 'groupId';
            var portraitUri = 'http://xxx.xxx.com/portraitUri.png';
            _instance.Group.setPortaitUri(groupId, portraitUri, function(){
                //setPortaitUri Successfully
            });
         */
        var setPortaitUri = function(groupId, portraitUri, callback) {
            groupDatProvider.setPortaitUri(groupId, portraitUri, function() {
                groupHandle(groupId, function(index) {
                    data[index].group.portraitUri = portraitUri;
                });
                callback();
            });
        };
        /** 
         * 群名称重命名
         * @memberof Group 
         * @param {string}   groupId - 群 Id
         * @param {string}   name - 群新名称
         * @param {function}   callback - 返回群重命名结果
         * @see {@link GroupProvider}
         * @example
            var _instance = RongDataModel.init({appkey:'appkey'});
            var groupId = 'groupId';
            var name = 'rename';
            _instance.Group.rename(groupId, name, function(){
                //rename Successfully
            });
         */
        var rename = function(groupId, name, callback) {
            groupDatProvider.rename(groupId, name, function() {
                groupHandle(groupId, function(index) {
                    data[index].group.name = name;
                });
                callback();
            });
        };
        /** 
         * 发布群公告
         * @memberof Group 
         * @param {string}   groupId - 群 Id
         * @param {string}   notice - 公告内容
         * @param {function}   callback - 返回发布公告结果
         * @see {@link GroupProvider}
         * @example
            var _instance = RongDataModel.init({appkey:'appkey'});
            var groupId = 'groupId';
            var notice = '公告内容';
            _instance.Group.setNotice(groupId, notice, function(){
                //setNotice Successfully
            });
         */
        var setNotice = function(groupId, notice, callback) {
            groupDatProvider.setNotice(groupId, notice, function() {
                callback();
            });
        };
        var _pushHeadInfo = function(result) {
            var _heads = result.result;
            loop(_heads, function(item) {
                var head = headInfo[item.groupId] || (headInfo[item.groupId] = {
                    title: [],
                    portait: []
                });
                head.title.push(item.nickname);
                head.portait.push(item.portraitUri);
            });
            emit('FetchEnd');
        };

        var _pushGrups = function(groups) {
            groups.reverse();
            loop(groups, function(item) {
                data.push(item);
            });
            emit('FetchEnd');
            Group.watch(data);
        };
        watcher('Pull_GroupHead', function() {
            groupDatProvider.getHeadInfo(option.group_head_count, function(result) {
                headInfo = {};
                _pushHeadInfo(result);
            });
        });
        watcher('Pull_Group', function() {
            groupDatProvider.get(function(data) {
                _pushGrups(data.result);
            });
        });
        watcher('Clear_Group', function() {
            data.length = 0;
            groupMembers = {};
            headInfo = {};
        });

        var addToAddress = function(groupId, show, callback) {
            groupDatProvider.addToAddress(groupId, show, function(result) {
                if (show) {
                    emit('Pull_Group');
                } else {
                    for (var i = 0, len = data.length; i &lt; len; i++) {
                        if (data[i].group.id == groupId) {
                            data.splice(i, 1);
                            break;
                        }
                    }
                }
                callback(result);
            });
        };

        return {
            watch: watch,
            create: create,
            join: join,
            quit: quit,
            get: get,
            dismiss: dismiss,
            transferManager: transferManager,
            setNotice: setNotice,
            setPortaitUri: setPortaitUri,
            setDisplayName: setDisplayName,
            rename: rename,
            getMembers: getMembers,
            addMember: addMember,
            kickMember: kickMember,
            addToAddress: addToAddress,
            groupMembers: groupMembers
        };
    })(GroupDataProvider);

    /** Group DataModel end region */

    /** Conversation DataModel region */

    /**
     *  @namespace Conversation
     */

    /**
     * 会话模型数据接口
     * @namespace ConversationProvider
     */
    var ConversationDataProvider = {
        /** 
         * 获取会话列表  
         * @memberof ConversationProvider 
         * @param {function}   callback - 返回会话列表
         */
        getConversationList: function(callback) {
            RongIMLib.RongIMClient.getInstance().getConversationList({
                onSuccess: function(result) {
                    callback(result);
                },
                onError: function(error) {}
            }, [1, 3]);
        },
        sortConversationList: function(conversationList, callback) {
            var convers = [];
            for (var i = 0, len = conversationList.length; i &lt; len; i++) {
                if (!conversationList[i]) {
                    continue;
                }
                if (conversationList[i].isTop) {
                    convers.push(conversationList[i]);
                    conversationList.splice(i, 1);
                    continue;
                }
                for (var j = 0; j &lt; len - i - 1; j++) {
                    if (conversationList[j].sentTime &lt; conversationList[j + 1].sentTime) {
                        var swap = conversationList[j];
                        conversationList[j] = conversationList[j + 1];
                        conversationList[j + 1] = swap;
                    }
                }
            }
            return convers.concat(conversationList);
        },
        getTotalUnreadCount: function(conversationTypes, callback) {
            RongIMClient.getInstance().getConversationUnreadCount(conversationTypes, {
                onSuccess: function(count) {
                    callback(count);
                },
                onError: function(error) {}
            });
        },
        /** 
         * 清除未读消息数  
         * @memberof ConversationProvider 
         * @param {number} conversationType - 会话类型
         * @param {string} targetId - 目标 Id 
         */
        clearUnReadCount: function(conversationType, targetId) {
            RongIMLib.RongIMClient.getInstance().clearUnreadCount(conversationType, targetId, {
                onSuccess: function(count) {},
                onError: function() {}
            });
        },
        /** 
         * 删除会话  
         * @memberof ConversationProvider 
         * @param {number} conversationType - 会话类型
         * @param {string} targetId - 目标 Id 
         */
        remove: function(conversationType, targetId) {
            RongIMClient.getInstance().removeConversation(conversationType, targetId, {
                onSuccess: function(bool) {},
                onError: function(error) {}
            });
        }
    };

    var bindUser = function(item, callback) {
        var process = function(user) {
            item.user = user;
            callback &amp;&amp; callback(user);
        };
        if (item.conversationType == RongIMLib.ConversationType.PRIVATE) {
            User.get(item.senderUserId || item.targetId, process);
        } else if (item.conversationType == RongIMLib.ConversationType.GROUP) {
            if (item.latestMessage) {
                // 会话最后一条消息绑定用户信息
                User.get(item.latestMessage.senderUserId, function(user) {
                    item.latestMessage.user = user;
                    item.group = Group.get(item.targetId);
                });
            } else if (item.senderUserId) {
                // 群消息绑定用户信息
                User.get(item.senderUserId, process);
            } else {
                // 会话列表刷新使用
                item.group = Group.get(item.targetId);
                callback(item);
            }
        } else {
            // TODO 扩展
            process({});
        }
    };

    var getPrivateUserIds = function(data) {
        var userIds = [];
        for (var i = 0, len = data.length; i &lt; len; i++) {
            var item = data[i];
            if (item.conversationType == RongIMLib.ConversationType.PRIVATE) {
                userIds.push(item.senderUserId || item.targetId);
            }
        }
        return userIds;
    };

    var composeUserInfo = function(data, callback) {
        if (getPrototype.call(data) == '[object Array]') {
            var userIds = getPrivateUserIds(data);
            User.batch(userIds, function() {
                for (var i = 0, len = data.length; i &lt; len; i++) {
                    bindUser(data[i]);
                }
                callback &amp;&amp; callback(data);
            });
        } else {
            bindUser(data, callback);
        }
    };

    var Conversation = (function(conDataProvider) {
        var data = [];
        var watch = function(conversation) {

        };
        /** 
         * 获取列表
         * @memberof Conversation 
         * @see {@link Conversation}
         * @example
            var _instance = RongDataModel.init({appkey:'appkey'});
            _instance.Conversation.get(function(list){
                // list 会话列表
            });
         */
        var get = function(callback) {
            conDataProvider.getConversationList(function(conversations) {
                composeUserInfo(conversations, function(items) {
                    var _list = conDataProvider.sortConversationList(conversations);
                    callback(_list);
                });
            });
        };
        var getOne = function(conversation, callback) {
            var result = null;
            var conversationType = conversation.conversationType,
                targetId = conversation.targetId;
            for (var i = 0, len = data.length; i &lt; len; i++) {
                var item = data[i];
                if (conversationType == item.conversationType &amp;&amp; targetId == item.targetId) {
                    result = data[i];
                }
            }
            // 本地没有在服务器取
            if (result) {
                callback &amp;&amp; callback(result);
            } else {
                callback &amp;&amp; composeUserInfo(conversation, callback);
            }
            return result;
        };
        /** 
         * 置顶会话
         * @memberof Conversation 
         * @param {string}   conversation - 会话对象
         * @see {@link Conversation}
         * @example
            var _instance = RongDataModel.init({appkey:'appkey'});
            var conversation = {conversationType:'', targetId:''}; // 请获取完整的会话对象
            _instance.Conversation.setConversationTop(conversation, function(){
                // 置顶成功
            });
         */
        var setConversationTop = function(conversation, callback) {
            data.unshift(conversation);
            callback &amp;&amp; callback();
        };
        /** 
         * 修改会话
         * @memberof Conversation 
         * @param {string}   conversation - 会话对象
         * @see {@link Conversation}
         * @example
            var _instance = RongDataModel.init({appkey:'appkey'});
            var conversation = {conversationType:'', targetId:''}; // 请获取完整的会话对象
            _instance.Conversation.set(conversation, function(){
                // 修改会话成功
            });
         */
        var set = function(conversation) {
            var isInsert = true;
            for (var i = 0, len = data.length; i &lt; len; i++) {
                if (data[i].conversationType == conversation.conversationType &amp;&amp; data[i].targetId == conversation.targetId) {
                    setConversationTop(data.splice(i, 1)[0]);
                    isInsert = false;
                    break;
                }
            }
            //TODO  setTop
            if (isInsert) {
                composeUserInfo(conversation, function(result) {
                    setConversationTop(result);
                });
            }
            Conversation.watch(conversation);
        };
        /** 
         * 清除未读消息数
         * @memberof Conversation 
         * @param {string}   conversation - 会话对象
         * @see {@link Conversation}
         * @example
            var _instance = RongDataModel.init({appkey:'appkey'});
            var conversation = {conversationType:'', targetId:''}; // 请获取完整的会话对象
            _instance.Conversation.clearUnReadCount(conversationType, targetId);
         */
        var clearUnReadCount = function(conversationType, targetId) {
            //TODO 发送多端同步消息
            conDataProvider.clearUnReadCount(conversationType, targetId);
            var clearUnread = function(conversation) {
                conversation.unreadMessageCount = 0;
            };
            for (var i = 0, len = data.length; i &lt; len; i++) {
                if (data[i].conversationType == conversationType &amp;&amp; data[i].targetId == targetId) {
                    clearUnread(data[i]);
                    break;
                }
            }
        };
        /** 
         * 总未读消息数
         * @memberof Conversation 
         * @param {string}   conversation - 会话对象
         * @see {@link Conversation}
         * @example
            var _instance = RongDataModel.init({appkey:'appkey'});
            var conversationTypes = [_instance.Conversation.ConversationType.PRIVATE,_instance.Conversation.ConversationType.GROUP];
            _instance.Conversation.getTotalUnreadCount(conversationTypes, function(count){
                // count : 总未读消息数
            });
         */
        var getTotalUnreadCount = function(conversationTypes, callback) {
            conDataProvider.getTotalUnreadCount(conversationTypes, callback);
        };
        /** 
         * 设置草稿
         * @memberof Conversation 
         * @param {string}   conversationType - 会话类型
         * @param {string}   targetId - 目标 Id
         * @example
            var _instance = RongDataModel.init({appkey:'appkey'});
            var conversationType = _instance.ConversationType.PRIVATE;
            var targetId = "dkdadi90";
            var draft = "hello";
            _instance.Conversation.setDraft(conversationType, targetId, draft);
         */
        var setDraft = function(conversationType, targetId, draft) {
            for (var i = 0, len = data.length; i &lt; len; i++) {
                if (data[i].conversationType == conversationType &amp;&amp; data[i].targetId == targetId) {
                    data[i].draft = draft;
                    break;
                }
            }
        };
        /** 
         * 获取草稿
         * @memberof Conversation 
         * @param {string}   conversationType - 会话类型
         * @param {string}   targetId - 目标 Id
         * @example
            var _instance = RongDataModel.init({appkey:'appkey'});
            var conversationType = _instance.ConversationType.PRIVATE;
            var targetId = "dkdadi90";
            var draft = _instance.Conversation.getDraft(conversationType, targetId);
            console.log(draft);
         */
        var getDraft = function(conversationType, targetId) {
            var draft = "";
            for (var i = 0, len = data.length; i &lt; len; i++) {
                if (data[i].conversationType == conversationType &amp;&amp; data[i].targetId == targetId) {
                    draft = data[i].draft;
                    break;
                }
            }
            return draft;
        };
        var removeConversation = function(index, conversationType, targetId) {
            data.splice(index, 1);
            clearUnReadCount(conversationType, targetId);
        };
        /** 
         * 隐藏
         * @memberof Conversation 
         * @param {number}   conversationType - 会话类型
         * @param {string}   targetId - 目标 Id
         * @see {@link Conversation}
         * @example
            var _instance = RongDataModel.init({appkey:'appkey'});
            var conversationType = 1;
            var targetId = ''; 
            _instance.Conversation.hidden(conversationType, targetId);
         */
        var hidden = function(conversationType, targetId) {
            for (var i = 0, len = data.length; i &lt; len; i++) {
                if (data[i].conversationType == conversationType &amp;&amp; data[i].targetId == targetId) {
                    removeConversation(i, conversationType, targetId);
                    break;
                }
            }
        };
        /** 
         * 删除会话
         * @memberof Conversation 
         * @param {number}   conversationType - 会话类型
         * @param {string}   targetId - 目标 Id
         * @see {@link Conversation}
         * @example
            var _instance = RongDataModel.init({appkey:'appkey'});
            var conversationType = 1;
            var targetId = ''; 
            _instance.Conversation.remove(conversationType, targetId);
         */
        var remove = function(conversationType, targetId) {
            conDataProvider.remove(conversationType, targetId);
            hidden(conversationType, targetId);
        };

        watcher('Conversation', function(data) {
            data = data || RongIMClient._memoryStore.conversationList.slice(0, 1)[0];
            set(data);
        });
        watcher('Clear_Conversation', function() {
            data.length = 0;
        });

        var conversationModel = {
            hidden: hidden,
            remove: remove,
            set: set,
            get: get,
            setDraft: setDraft,
            getDraft: getDraft,
            clearUnReadCount: clearUnReadCount,
            getTotalUnreadCount: getTotalUnreadCount,
            getOne: getOne,
            watch: watch,
            data: data
        };
        var bindings = ['PRIVATE', 'DISCUSSION', 'GROUP', 'CHATROOM', 'CUSTOMER_SERVICE', 'SYSTEM', 'APP_PUBLIC_SERVICE', 'PUBLIC_SERVICE'];
        loop(bindings, function(proto) {
            conversationModel[proto] = RongIMLib.ConversationType[proto];
        });
        return conversationModel;
    })(ConversationDataProvider);

    /** Conversation DataModel end region */

    /** Message DataModel region */

    /**
     *  @namespace Message
     */

    /**
     * 会话模型数据接口
     * @namespace MessageProvider
     */

    var getMessageId = function() {
        return RongIMLib.MessageIdHandler.messageId + 1;
    };
    var genLocalMsg = function(params) {
        var msg = new RongIMLib.Message();
        msg.content = params.content;
        msg.conversationType = params.conversationType;
        msg.targetId = params.targetId;
        msg.senderUserId = currentUserId;
        msg.sentStatus = RongIMLib.SentStatus.SENDING;
        msg.messageId = getMessageId();
        msg.messageDirection = RongIMLib.MessageDirection.SEND;
        msg.messageType = params.content.messageName;
        return msg;
    };
    var MessageDataProvider = {
        /**
            获取历史消息
            @param {object} params - 获取历史消息参数对象
            @param {number} params.conversationType - 会话类型
            @param {number} params.targetId - 目标 id
            @param {number} params.timestamp - 获取历史消息开始时间
            @param {number} params.count - 每次获取条数
            @param {object} callback - 返回历史消息
            @memberof MessageProvider
         */
        getHistoryMessages: function(params, callback) {
            RongIMLib.RongIMClient.getInstance().getHistoryMessages(params.conversationType, params.targetId, params.timestamp, option.get_historyMsg_count, {
                onSuccess: function(list, hasMore) {
                    callback(list, hasMore);
                },
                onError: function(error) {}
            });
        },
        /**
            发送消息
            @param {object} params - 获取历史消息参数对象
            @param {number} params.conversationType - 会话类型
            @param {number} params.targetId - 目标 id
            @param {number} params.content - 消息内容
            @param {boolean} params.mentiondMsg - @ 消息标识
            @param {string} params.pushText - push 内容
            @param {string} params.appData - 对 pushText 内容的扩展
            @param {object} callback - 返回发送消息结果
            @memberof MessageProvider
         */
        sendMessage: function(params, callback) {
            callback(genLocalMsg(params));
            RongIMLib.RongIMClient.getInstance().sendMessage(params.conversationType, params.targetId, params.content, {
                onSuccess: function(message) {
                    callback(message);
                },
                onError: function(errorCode, message) {
                    callback(message);
                }
            }, params.mentiondMsg, params.pushText, params.appkey, params.methodType);
        }
    };
    var Message = (function(messageDataProvider) {
        var data = {};
        /**
         * 消息变化监听
         * @memberof Message
           @example
            var _instance = RongDataModel.init({appkey:'appkey'});
            _instance.Message.watch = function(message){
            };
         */
        var watch = function(message) {};
        var genDataUId = function(conversationType, targetId) {
            return 'cm_' + conversationType + targetId;
        };
        var set = function(message) {
            if (message) {
                var key = genDataUId(conversationType, targetId);
                data[key] &amp;&amp; data[key].push(message);
            }
        };
        /**
         * 获取历史消息
         * @param {object} params - 获取历史消息参数对象
         * @param {number} params.conversationType - 会话类型
         * @param {number} params.targetId - 目标 id
         * @param {number} params.timestamp - 获取历史消息开始时间
         * @param {object} callback - 返回历史消息
         * @see {@link MessageProvider}
         * @memberof Message
         * @example
             var _instance = RongDataModel.init({appkey:'appkey'});
             var params = {
                conversationType:1,
                targetId:'',
                timestamp:0
             };
             _instance.Message.get(params, function(result, hasMore){
                // result: 历史消息数组
                // hasMore : 是否有更多的历史消息
             });
         */
        var get = function(params, callback) {
            var key = genDataUId(params.conversationType, params.targetId);
            var memoryMsgs = data[key];
            if (params.position == 2 || !memoryMsgs) {
                params.timestamp = params.timestamp || 0;
                messageDataProvider.getHistoryMessages(params, function(list, hasMore) {
                    composeUserInfo(list, function(result) {
                        if (!memoryMsgs) {
                            data[key] = result;
                        } else if (memoryMsgs.length &lt; option.max_msg_count) {
                            data[key].concat(result);
                        }
                        callback(result, hasMore);
                    });
                });
            } else {
                callback(memoryMsgs, true);
            }
        };
        var _push = function(message) {
            var key = genDataUId(message.conversationType, message.targetId);
            var isInsert = true;
            composeUserInfo(message, function() {
                data[key] = data[key] || [];
                for (var i = 0, len = data[key].length; i &lt; len; i++) {
                    if (data[key][i].messageId == message.messageId) {
                        data[key][i].sentStatus = message.sentStatus;
                        isInsert = false;
                        break;
                    }
                }
                isInsert &amp;&amp; data[key].push(message);
                emit('Conversation', message);
                Message.watch(message);
            });

        };
        /**
         * 发送消息
         * @param {object} params - 获取历史消息参数对象
         * @param {number} params.conversationType - 会话类型
         * @param {number} params.targetId - 目标 id
         * @param {number} params.content - 消息内容
         * @param {boolean} params.mentiondMsg - @ 消息标识
         * @param {string} params.pushText - push 内容
         * @param {string} params.appData - 对 pushText 内容的扩展
         * @param {object} callback - 返回发送消息结果
         * @memberof Message
         * @see {@link MessageProvider}
         * @example
             var _instance = RongDataModel.init({appkey:'appkey'});
             var params = { 
                conversationType:1,
                targetId:'',
                content:_instance.Message.TextMessage.obtain('hello world')
             };
             _instance.Message.send(params);
         */
        var send = function(params) {
            messageDataProvider.sendMessage(params, function(message) {
                _push(message);
            });
        };
        watcher('Message', function(message) {
            _push(message);
        });
        watcher('Clear_Message', function() {
            data = {};
        });

        var userModel = {
            set: set,
            get: get,
            send: send,
            watch: watch,
            TextMessage: RongIMLib.TextMessage,
            MessageDataProvider: messageDataProvider
        };
        // 动态暴露 RongIMLib Message 相关属性。
        var bindings = ['TextMessage', 'FileMessage', 'ImageMessage'];
        loop(bindings, function(proto) {
            userModel[proto] = RongIMLib[proto];
        });
        return userModel;
    })(MessageDataProvider);
    /** Message DataModel end region */

    /** Status DataModel region */

    var starPath = {
        all: 'user/starlist',
        star: 'user/star',
        unstar: 'user/unstar',
        set_display_name: 'user/set_star_displayname'
    };

    var StarProvider = {
        getAll: function(callback) {
            var url = genUrl(starPath.all);
            request(url, {
                success: function(data) {
                    callback(data.result);
                }
            });
        },
        star: function(targetId, callback) {
            var data = {
                targetId: targetId
            };
            var url = genUrl(starPath.star);
            request(url, {
                method: 'POST',
                data: jsonStringify(data),
                success: callback
            });
        },
        unstar: function(targetId, callback) {
            var data = {
                targetId: targetId
            };
            var url = genUrl(starPath.unstar);
            request(url, {
                method: 'POST',
                data: jsonStringify(data),
                success: callback
            });
        },
        setDisplayName: function(info, callback) {
            var url = genUrl(starPath.set_display_name);
            request(url, {
                method: 'POST',
                data: jsonStringify(info),
                success: callback
            });
        }
    };

    var Star = (function(starProvider) {
        var data = [];
        var watch = function(star) {};
        var getAll = function(callback) {
            if (data.length > 0) {
                callback(data);
            } else {
                starProvider.getAll(function(stars) {
                    data = stars;
                    userFormat(stars, function(user) {
                        emit('User', user); // fire User, cache userInfo.
                    });
                    callback(data);
                });
            }
        };
        var star = function(targetId, callback) {
            starProvider.star(targetId, function(result) {
                User.get(targetId, function(user) {
                    user.star = 1;
                    data.push(user);
                });
                callback(result);
            });
        };
        var unstar = function(targetId, callback) {
            starProvider.unstar(targetId, function(result) {
                for (var i = 0, len = data.length; i &lt; len; i++) {
                    if (data[i].id == targetId) {
                        data.splice(i, 1);
                        break;
                    }
                }
                callback(result);
            });
        };

        var setDisplayName = function(info, callback) {
            starProvider.setDisplayName(info, function(result) {
                var userData = {};
                userData[info.targetId] = {
                    displayName: info.displayName
                };
                emit('User', userData);
                callback(result);
            });
        };

        var _push = function(result) {
            data = result;
        };

        watcher('Star', function(result) {
            _push(result);
        });

        watcher('Pull_Star', function() {
            starProvider.getAll(function(result) {
                emit('Star', result);
                userFormat(result, function(user) {
                    emit('User', user); // fire User, cache userInfo.
                });
                emit('FetchEnd');
            });
        });
        watcher('Clear_Star', function() {
            data.length = 0;
        });

        return {
            watch: watch,
            getAll: getAll,
            star: star,
            unstar: unstar,
            setDisplayName: setDisplayName,
            starProvider: starProvider
        };
    })(StarProvider);

    /**
     * @namespace Status
     */
    var Status = (function() {
        var data = -2;
        /**
         * 状态监听
         * @memberof Status
         * @example
           var _instance = RongDataModel.init({appkey:'appkey'});
           var connStatus = _instance.Status.ConnectionStatus;
           _instance.Status.watch = function(status){
                if(status == connStatus.CONNECTING){
                    // 连接中
                }elseif (status == connStatus.CONNECTED) {
                    // 连接成功
                } 
           };
         */
        var watch = function(status) {};
        /**
         * 获取当前连接状态
         * @memberof Status
         * @example
           var _instance = RongDataModel.init({appkey:'appkey'});
           var status = _instance.Status.get();
           console.log(status);
         * @returns {number}
         */
        var get = function() {
            return data;
        };
        /**
         * 连接服务器
         * @memberof Status
         * @param {string} token - 用户在融云的唯一身份标识
         * @example
           var _instance = RongDataModel.init({appkey:'appkey'});
           var token = 'DsdfkDISk==';
           _instance.Status.connect(token);
         */
        var connect = function(token) {
            RongIMClient.connect(token, {
                onSuccess: function(userId) {
                    currentUserId = RongIMClient.getInstance().getCurrentUserId();
                },
                onTokenIncorrect: function() {
                    Status.watch(RongIMLib.ConnectionState.TOKEN_INCORRECT);
                },
                onError: function(errorCode) {
                    Status.watch(errorCode);
                }
            });
        };
        /**
         * 断开与服务器连接
         * @memberof Status
         * @example
           var _instance = RongDataModel.init({appkey:'appkey'});
           _instance.Status.disconnect();
         */
        var disconnect = function() {
            RongIMClient._memoryStore.conversationList.length = 0; // SDK TODO 
            RongIMClient.getInstance().logout();
        };
        var _push = function(status) {
            data = status;
            Status.watch(status);
        };
        watcher('Status', function(status) {
            _push(status);
        });
        var statusModel = {
            get: get,
            connect: connect,
            disconnect: disconnect,
            watch: watch
        };
        // 动态暴露 RongIMLib 状态相关属性。
        var bindings = ['ConnectionStatus'];
        loop(bindings, function(proto) {
            statusModel[proto] = RongIMLib[proto];
        });
        return statusModel;
    })();
    /** Status DataModel end region */

    var fetchData = function(callback) {
        fetchModelData(option.data, callback);
    };
    /**
     * 初始化
     * @memberof RongDataModel
     * @static
     * @example
        var config = {
            appkey:'',                              // 必传
            dataAccessProvider:null,                // 可选
            dm:{                                    // 可选
                max_msg_count:20,                   // 本地缓存消息条数上限
                max_conversation_count:50,          // 本地缓存会话个数上限
                get_historyMsg_count:5,             // 每次拉取历史消息个数
                server_path:'http://api.cn/',       // Server 地址,请以 '/' 结尾
                data:['User', 'Group', 'Friend']    // 可选 默认获取用户、群组、好友信息
            },                      
            sdk:{navi:''}                           // 可选
        };
        var _instance = RongDataModel.init(config);
     */
    var init = function(config) {
        if (config &amp;&amp; config.dm) {
            var imOpts = config.dm;
            forEach(imOpts, function(key, value) {
                option[key] = value;
            });
        }

        RongIMClient.init(config.appkey, config.dataAccessProvider, config.sdk);
        RongIMClient.setConnectionStatusListener({
            onChanged: function(status) {
                emit('Status', status);
            }
        });
        RongIMClient.setOnReceiveMessageListener({
            onReceived: function(message) {
                emit('Message', message);
            }
        });

        return {
            User: User,
            Group: Group,
            Friend: Friend,
            Conversation: Conversation,
            Message: Message,
            Status: Status,
            Star: Star,
            option: option,
            fetchData: fetchData
        };
    };

    win.RongDataModel = {
        init: init
    };
})(window, RongIMLib, RongIMClient);</pre>
    </article>
</section>





		</div>
	</div>

	<div class="clearfix"></div>

	

</div>
</div>


    <div class="modal fade" id="searchResults">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title">Search results</h4>
          </div>
          <div class="modal-body"></div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
          </div>
        </div><!-- /.modal-content -->
      </div><!-- /.modal-dialog -->
    </div>


<footer>


<span class="jsdoc-message">
	Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.3</a>
	
		on Wed Jan 11th 2017
	
	using the <a href="https://github.com/docstrap/docstrap">DocStrap template</a>.
</span>
</footer>

<script src="scripts/docstrap.lib.js"></script>
<script src="scripts/toc.js"></script>

    <script type="text/javascript" src="scripts/fulltext-search-ui.js"></script>


<script>
$( function () {
	$( "[id*='$']" ).each( function () {
		var $this = $( this );

		$this.attr( "id", $this.attr( "id" ).replace( "$", "__" ) );
	} );

	$( ".tutorial-section pre, .readme-section pre, pre.prettyprint.source" ).each( function () {
		var $this = $( this );

		var example = $this.find( "code" );
		exampleText = example.html();
		var lang = /{@lang (.*?)}/.exec( exampleText );
		if ( lang && lang[1] ) {
			exampleText = exampleText.replace( lang[0], "" );
			example.html( exampleText );
			lang = lang[1];
		} else {
			var langClassMatch = example.parent()[0].className.match(/lang\-(\S+)/);
			lang = langClassMatch ? langClassMatch[1] : "javascript";
		}

		if ( lang ) {

			$this
			.addClass( "sunlight-highlight-" + lang )
			.addClass( "linenums" )
			.html( example.html() );

		}
	} );

	Sunlight.highlightAll( {
		lineNumbers : true,
		showMenu : true,
		enableDoclinks : true
	} );

	$.catchAnchorLinks( {
        navbarOffset: 10
	} );
	$( "#toc" ).toc( {
		anchorName  : function ( i, heading, prefix ) {
			return $( heading ).attr( "id" ) || ( prefix + i );
		},
		selectors   : "#toc-content h1,#toc-content h2,#toc-content h3,#toc-content h4",
		showAndHide : false,
		smoothScrolling: true
	} );

	$( "#main span[id^='toc']" ).addClass( "toc-shim" );
	$( '.dropdown-toggle' ).dropdown();

    $( "table" ).each( function () {
      var $this = $( this );
      $this.addClass('table');
    } );

} );
</script>



<!--Navigation and Symbol Display-->


<!--Google Analytics-->



    <script type="text/javascript">
        $(document).ready(function() {
            SearcherDisplay.init();
        });
    </script>


</body>
</html>
